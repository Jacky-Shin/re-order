# 故障排查指南

## 常见问题及解决方案

### 1. 页面卡死/无响应

#### 症状
- 页面加载后无响应
- 点击按钮没有反应
- 浏览器标签页显示"无响应"

#### 可能原因
1. **网络请求超时**
   - API 请求没有响应
   - 服务器未启动或无法访问

2. **无限循环**
   - useEffect 依赖项设置错误
   - 状态更新导致无限重渲染

3. **大量数据渲染**
   - 订单列表数据过多
   - 商品列表数据过多

#### 解决方案

**方案1：刷新页面**
```
按 F5 或 Ctrl+R 刷新页面
```

**方案2：检查网络连接**
- 检查服务器是否运行
- 检查 API 端点是否可访问
- 查看浏览器控制台的网络请求

**方案3：清除缓存**
```
1. 按 Ctrl+Shift+Delete 打开清除数据对话框
2. 选择"缓存的图像和文件"
3. 点击"清除数据"
4. 刷新页面
```

**方案4：检查浏览器控制台**
```
1. 按 F12 打开开发者工具
2. 查看 Console 标签页的错误信息
3. 查看 Network 标签页的请求状态
```

### 2. 订单状态不更新

#### 症状
- 订单状态一直显示"待处理"
- 商家端更新状态后，用户端不更新

#### 可能原因
1. **轮询被停止**
   - 网络错误导致轮询停止
   - 达到最大重试次数

2. **实时监听失效**
   - Firebase 连接断开
   - localStorage 同步失败

#### 解决方案

**方案1：手动刷新**
```
刷新订单状态页面
```

**方案2：检查网络连接**
- 确保网络连接正常
- 检查防火墙设置

**方案3：重新加载订单**
```
1. 返回菜单页面
2. 重新进入订单状态页面
```

### 3. 支付卡死

#### 症状
- 点击支付按钮后无反应
- 支付处理中一直显示

#### 可能原因
1. **Stripe API 超时**
   - 网络连接慢
   - Stripe 服务不可用

2. **打印操作阻塞**
   - 打印机连接失败
   - 打印服务无响应

#### 解决方案

**方案1：等待超时**
```
系统会在 10 秒后自动超时，然后显示错误信息
```

**方案2：检查支付状态**
```
1. 查看订单状态页面
2. 如果支付成功但页面未跳转，手动刷新
```

**方案3：重新支付**
```
1. 返回订单页面
2. 重新尝试支付
```

### 4. 打印失败

#### 症状
- 付款成功后没有打印小票
- 控制台显示打印错误

#### 可能原因
1. **打印机未连接**
   - 打印机未开机
   - 网络连接断开
   - IP 地址配置错误

2. **打印服务超时**
   - 打印机响应慢
   - 网络延迟高

#### 解决方案

**方案1：检查打印机连接**
```
1. 确认打印机已开机
2. 检查打印机网络连接
3. 确认 IP 地址配置正确
```

**方案2：测试打印机连接**
```
访问：GET http://localhost:5000/api/printer/test
查看返回结果
```

**方案3：手动打印**
```
1. 在订单详情页面
2. 使用浏览器打印功能（Ctrl+P）
```

### 5. 数据加载慢

#### 症状
- 页面加载时间过长
- 商品列表显示慢

#### 可能原因
1. **数据量过大**
   - 订单数量过多
   - 商品数量过多

2. **网络延迟**
   - 网络连接慢
   - 服务器响应慢

#### 解决方案

**方案1：优化数据量**
```
系统已自动限制：
- 订单列表最多显示 200 条
- 排队信息最多处理 100 条订单
```

**方案2：使用筛选功能**
```
在商家端使用状态筛选，减少显示的数据量
```

**方案3：检查网络**
```
1. 检查网络连接速度
2. 检查服务器性能
```

### 6. 内存泄漏

#### 症状
- 长时间使用后浏览器变慢
- 内存使用持续增长

#### 可能原因
1. **事件监听器未清理**
   - useEffect 清理函数缺失
   - 定时器未清除

2. **大量数据缓存**
   - localStorage 数据过多
   - 状态数据未清理

#### 解决方案

**方案1：定期刷新页面**
```
长时间使用后，定期刷新页面清理内存
```

**方案2：清除浏览器数据**
```
1. 清除 localStorage
2. 清除缓存
3. 刷新页面
```

**方案3：重启浏览器**
```
关闭并重新打开浏览器
```

## 性能优化建议

### 1. 减少不必要的重渲染
- 使用 React.memo 包装组件
- 使用 useMemo 和 useCallback 优化计算

### 2. 优化网络请求
- 使用防抖和节流
- 合并多个请求
- 使用缓存

### 3. 限制数据量
- 分页加载
- 虚拟滚动
- 懒加载

### 4. 监控性能
- 使用浏览器性能工具
- 监控内存使用
- 检查网络请求时间

## 紧急恢复方案

如果系统完全无法使用：

1. **重启服务器**
   ```bash
   # 停止服务器
   # 重新启动服务器
   ```

2. **清除所有数据**
   ```javascript
   // 在浏览器控制台执行
   localStorage.clear();
   location.reload();
   ```

3. **检查日志**
   - 查看服务器日志
   - 查看浏览器控制台
   - 查看网络请求日志

## 联系支持

如果以上方案都无法解决问题，请：
1. 记录错误信息
2. 截图错误页面
3. 记录操作步骤
4. 联系技术支持

