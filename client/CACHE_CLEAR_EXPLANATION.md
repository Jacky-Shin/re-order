# 缓存清除功能说明

## 数据保护机制

自动更新功能**不会删除任何业务数据**，只会清除浏览器缓存。

### ✅ 会被保留的数据

#### 业务数据（完全保留）
- **商品数据** (`db_menu_items`) - 所有上架的商品
- **订单数据** (`db_orders`) - 所有订单记录
- **分类数据** (`db_categories`) - 所有商品分类
- **支付记录** (`db_payments`) - 所有支付记录
- **商家账户** (`db_merchant_accounts`) - 商家银行账户信息
- **订单计数器** (`db_last_order_number`, `db_last_pickup_number`, `db_last_pickup_date`) - 订单编号相关
- **店铺设置** (`db_shop_settings`) - 店铺配置和图片

#### 用户配置（保留）
- **语言设置** (`userLanguage`, `adminLanguage`) - 用户选择的语言
- **登录状态** (`adminUsername`) - 管理员登录信息

#### 系统配置（保留）
- **Firebase配置** (`firebaseConfig`) - Firebase连接配置
- **调试工具** (`eruda`) - 开发调试工具设置

### 🗑️ 会被清除的数据

#### 浏览器缓存（清除）
- **Cache API缓存** - 浏览器缓存的静态资源（JS、CSS、图片等）
- **Service Worker** - 已注册的Service Worker（如果存在）

#### 临时数据（清除）
- **sessionStorage** - 会话临时数据（不影响业务数据）
- **其他localStorage项** - 除了业务数据和配置外的其他临时数据

### 🔄 数据同步机制

#### 如果使用Firebase
- 数据会自动从Firebase云端同步回来
- 清除缓存后，数据会从Firebase重新加载
- **完全不用担心数据丢失**

#### 如果不使用Firebase
- 数据存储在localStorage中
- **所有业务数据都会被保留**
- 清除缓存不会影响localStorage中的业务数据

## 更新流程

1. **检测新版本** - 自动检测是否有新版本
2. **清除缓存** - 只清除浏览器缓存，保留所有业务数据
3. **保存版本号** - 更新本地版本号
4. **刷新页面** - 自动刷新以加载新版本

## 安全保证

- ✅ **商品数据** - 100%保留
- ✅ **订单记录** - 100%保留
- ✅ **支付记录** - 100%保留
- ✅ **分类数据** - 100%保留
- ✅ **商家账户** - 100%保留
- ✅ **用户设置** - 100%保留

## 常见问题

### Q: 更新后我的商品会消失吗？
**A: 不会！** 所有商品数据都会被保留。

### Q: 更新后订单记录会丢失吗？
**A: 不会！** 所有订单记录都会被保留。

### Q: 如果使用Firebase，数据会丢失吗？
**A: 不会！** Firebase中的数据会从云端自动同步回来。

### Q: 清除缓存会影响什么？
**A: 只影响浏览器缓存的静态资源（JS、CSS文件），不影响任何业务数据。**

## 技术细节

### 数据存储位置

1. **localStorage** - 存储所有业务数据（以`db_`开头）
2. **Firebase** - 如果配置，数据会同步到云端
3. **IndexedDB** - 目前不使用，如果将来使用也会被保护

### 清除逻辑

```typescript
// 只清除非业务数据
const keysToKeep = [
  'db_menu_items',      // 商品
  'db_orders',          // 订单
  'db_categories',      // 分类
  'db_payments',        // 支付
  'db_merchant_accounts', // 账户
  // ... 其他业务数据
];
```

## 总结

**您可以放心使用自动更新功能，它只会清除浏览器缓存，不会影响任何业务数据！**

