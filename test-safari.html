<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Safariè¿æ¥æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-card {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin: 10px 0;
        }
        .success { background: #4CAF50; color: white; }
        .error { background: #f44336; color: white; }
        .loading { background: #ff9800; color: white; }
        button {
            background: #00704A;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #005a3d; }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Safariè¿æ¥æµ‹è¯•å·¥å…·</h1>
    
    <div class="test-card">
        <h2>1. å‰ç«¯æœåŠ¡æµ‹è¯•</h2>
        <p>æµ‹è¯•åœ°å€: <code id="frontend-url">http://localhost:3000</code></p>
        <button onclick="testFrontend()">æµ‹è¯•å‰ç«¯è¿æ¥</button>
        <div id="frontend-status"></div>
    </div>
    
    <div class="test-card">
        <h2>2. åç«¯APIæµ‹è¯•</h2>
        <p>æµ‹è¯•åœ°å€: <code id="backend-url">http://localhost:5000/api/health</code></p>
        <button onclick="testBackend()">æµ‹è¯•åç«¯è¿æ¥</button>
        <div id="backend-status"></div>
    </div>
    
    <div class="test-card">
        <h2>3. ç½‘ç»œä¿¡æ¯</h2>
        <div class="info">
            <p><strong>å½“å‰é¡µé¢URL:</strong> <code id="current-url"></code></p>
            <p><strong>æµè§ˆå™¨:</strong> <code id="browser-info"></code></p>
            <p><strong>ç”¨æˆ·ä»£ç†:</strong> <code id="user-agent"></code></p>
        </div>
    </div>
    
    <div class="test-card">
        <h2>4. å¿«é€Ÿé“¾æ¥</h2>
        <p>
            <a href="http://localhost:3000" target="_blank">
                <button>æ‰“å¼€å‰ç«¯é¡µé¢</button>
            </a>
            <a href="http://localhost:5000/api/health" target="_blank">
                <button>æµ‹è¯•åç«¯API</button>
            </a>
        </p>
    </div>
    
    <div class="test-card">
        <h2>5. æ•…éšœæ’é™¤æç¤º</h2>
        <div class="info">
            <p><strong>å¦‚æœå‰ç«¯æ— æ³•è¿æ¥ï¼š</strong></p>
            <ul>
                <li>ç¡®ä¿å‰ç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼š<code>cd client && npm run dev</code></li>
                <li>æ£€æŸ¥3000ç«¯å£æ˜¯å¦è¢«å ç”¨</li>
                <li>å°è¯•æ¸…é™¤Safariç¼“å­˜</li>
            </ul>
            
            <p><strong>å¦‚æœåç«¯æ— æ³•è¿æ¥ï¼š</strong></p>
            <ul>
                <li>ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼š<code>cd server && npm run dev</code></li>
                <li>æ£€æŸ¥5000ç«¯å£æ˜¯å¦è¢«å ç”¨</li>
                <li>æŸ¥çœ‹åç«¯æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯</li>
            </ul>
            
            <p><strong>å¦‚æœä½¿ç”¨æ‰‹æœºSafariï¼š</strong></p>
            <ul>
                <li>å¿…é¡»ä½¿ç”¨IPåœ°å€ï¼Œä¸èƒ½ä½¿ç”¨localhost</li>
                <li>ç¡®ä¿æ‰‹æœºå’Œç”µè„‘åœ¨åŒä¸€WiFiç½‘ç»œ</li>
                <li>æ ¼å¼ï¼š<code>http://[ä½ çš„IP]:3000</code></li>
            </ul>
        </div>
    </div>

    <script>
        // æ˜¾ç¤ºå½“å‰ä¿¡æ¯
        document.getElementById('current-url').textContent = window.location.href;
        document.getElementById('browser-info').textContent = navigator.userAgent.includes('Safari') ? 'Safari' : 'å…¶ä»–æµè§ˆå™¨';
        document.getElementById('user-agent').textContent = navigator.userAgent;
        
        // å¦‚æœæ˜¯æ‰‹æœºè®¿é—®ï¼Œè‡ªåŠ¨æ£€æµ‹IP
        if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
            const ip = window.location.hostname;
            document.getElementById('frontend-url').textContent = `http://${ip}:3000`;
            document.getElementById('backend-url').textContent = `http://${ip}:5000/api/health`;
        }
        
        async function testFrontend() {
            const statusDiv = document.getElementById('frontend-status');
            const url = document.getElementById('frontend-url').textContent;
            
            statusDiv.innerHTML = '<span class="status loading">æµ‹è¯•ä¸­...</span>';
            
            try {
                const response = await fetch(url, {
                    method: 'GET',
                    mode: 'no-cors' // é¿å…CORSé—®é¢˜
                });
                
                // ç”±äºno-corsæ¨¡å¼ï¼Œæ— æ³•è¯»å–å“åº”ï¼Œä½†å¯ä»¥æ£€æŸ¥æ˜¯å¦æˆåŠŸ
                statusDiv.innerHTML = '<span class="status success">âœ… å‰ç«¯æœåŠ¡å¯è®¿é—®</span>';
            } catch (error) {
                statusDiv.innerHTML = `<span class="status error">âŒ æ— æ³•è¿æ¥å‰ç«¯: ${error.message}</span>`;
            }
        }
        
        async function testBackend() {
            const statusDiv = document.getElementById('backend-status');
            const url = document.getElementById('backend-url').textContent;
            
            statusDiv.innerHTML = '<span class="status loading">æµ‹è¯•ä¸­...</span>';
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.status === 'ok') {
                    statusDiv.innerHTML = '<span class="status success">âœ… åç«¯APIæ­£å¸¸</span>';
                } else {
                    statusDiv.innerHTML = '<span class="status error">âŒ åç«¯å“åº”å¼‚å¸¸</span>';
                }
            } catch (error) {
                statusDiv.innerHTML = `<span class="status error">âŒ æ— æ³•è¿æ¥åç«¯: ${error.message}</span><br>
                    <small>å¯èƒ½åŸå› ï¼šåç«¯æœªå¯åŠ¨ã€ç«¯å£è¢«å ç”¨ã€CORSé—®é¢˜</small>`;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.onload = function() {
            setTimeout(() => {
                testBackend();
            }, 1000);
        };
    </script>
</body>
</html>
