# 银行卡支付测试检查清单

## ✅ 测试前准备

- [ ] Stripe 账户已注册并激活
- [ ] 已获取测试环境 API 密钥（`pk_test_...` 和 `sk_test_...`）
- [ ] Vercel 环境变量已配置：
  - [ ] `VITE_STRIPE_PUBLISHABLE_KEY` = `pk_test_...`
  - [ ] `STRIPE_SECRET_KEY` = `sk_test_...`
- [ ] 应用已部署或本地运行正常
- [ ] 浏览器开发者工具已打开（F12）

---

## 🧪 基础功能测试

### 支付表单显示
- [ ] 选择"银行卡"或"Visa"时，显示 Stripe 支付表单
- [ ] 表单样式正确，没有布局问题
- [ ] 表单可以正常输入卡号、有效期、CVV
- [ ] 表单有适当的错误提示样式

### 成功支付流程
- [ ] 使用测试卡号 `4242 4242 4242 4242` 可以成功支付
- [ ] 支付后自动跳转到订单状态页面
- [ ] 订单状态显示为"已支付"
- [ ] 支付方式显示为"银行卡"或"Visa"
- [ ] 订单金额正确显示

---

## 🔍 数据验证

### Stripe Dashboard
- [ ] 登录 Stripe Dashboard（Test mode）
- [ ] 在 Payments 页面可以看到支付记录
- [ ] 支付状态为 "Succeeded"
- [ ] 支付金额正确
- [ ] 订单ID（metadata.orderId）正确关联

### 订单数据
- [ ] 订单的 `paymentId` 字段已设置
- [ ] 订单的 `paymentStatus` 为 `completed`
- [ ] 订单的 `paymentMethod` 为 `card` 或 `visa`
- [ ] 订单的 `totalAmount` 正确

### 支付记录
- [ ] 支付记录已创建
- [ ] 支付记录的 `amount` 正确
- [ ] 支付记录的 `method` 为 `card` 或 `visa`
- [ ] 支付记录的 `status` 为 `completed`
- [ ] 支付记录的 `transactionId` 已设置（Stripe Payment Intent ID）

---

## ❌ 错误处理测试

### 支付失败场景
- [ ] 使用被拒绝的卡号 `4000 0000 0000 0002` 显示错误信息
- [ ] 错误信息清晰易懂（"Your card was declined."）
- [ ] 支付失败后可以重试
- [ ] 支付失败后可以切换支付方式
- [ ] 使用余额不足的卡号 `4000 0000 0000 9995` 显示相应错误

### 网络错误
- [ ] 断开网络后尝试支付，显示网络错误
- [ ] 网络恢复后可以重试

### API错误
- [ ] Stripe API 错误时显示友好错误信息
- [ ] 不会泄露敏感信息（如 API 密钥）

---

## 🔐 3D Secure 测试

- [ ] 使用需要 3D Secure 的卡号 `4000 0027 6000 3184`
- [ ] 正确触发 3D Secure 验证窗口
- [ ] 验证流程正常
- [ ] 验证成功后支付成功
- [ ] 验证失败时显示错误

---

## 🎨 UI/UX 测试

- [ ] 支付按钮在处理中时显示"处理中..."或加载状态
- [ ] 支付按钮在处理中时禁用
- [ ] 支付成功后显示成功提示（如果有）
- [ ] 支付失败时显示错误提示
- [ ] 表单验证错误时显示相应提示
- [ ] 移动端显示正常（响应式设计）

---

## 🔒 安全测试

- [ ] 银行卡信息不经过我们的服务器（直接发送到 Stripe）
- [ ] 支付请求使用 HTTPS
- [ ] 不存储完整的银行卡信息
- [ ] 只存储交易ID，不存储卡号

---

## 📱 跨浏览器测试

- [ ] Chrome 浏览器测试通过
- [ ] Safari 浏览器测试通过
- [ ] Firefox 浏览器测试通过
- [ ] Edge 浏览器测试通过
- [ ] 移动端浏览器测试通过（iOS Safari、Chrome Mobile）

---

## 🌐 跨设备测试

- [ ] 桌面端测试通过
- [ ] 平板端测试通过
- [ ] 移动端测试通过

---

## 📊 性能测试

- [ ] 支付表单加载时间 < 2秒
- [ ] 创建支付意图响应时间 < 3秒
- [ ] 支付确认响应时间 < 5秒
- [ ] 页面跳转流畅，无卡顿

---

## 🐛 边界情况测试

- [ ] 金额为 0 时显示错误
- [ ] 金额为负数时显示错误
- [ ] 金额过大时（如 999999）正常处理
- [ ] 订单不存在时显示错误
- [ ] 重复支付同一订单的处理

---

## 📝 日志和监控

- [ ] 浏览器控制台无错误
- [ ] Stripe Dashboard 日志正常
- [ ] Vercel Functions 日志正常
- [ ] 支付事件正确记录

---

## ✅ 测试完成确认

完成所有测试后，确认：

- [ ] 所有基础功能测试通过
- [ ] 所有错误处理测试通过
- [ ] 所有安全测试通过
- [ ] 所有浏览器和设备测试通过
- [ ] 性能测试通过
- [ ] 日志和监控正常

---

## 📞 问题记录

如果发现任何问题，请记录：

1. **问题描述：**
   - 

2. **复现步骤：**
   - 

3. **预期结果：**
   - 

4. **实际结果：**
   - 

5. **浏览器/设备：**
   - 

6. **错误信息：**
   - 

7. **截图/日志：**
   - 

---

## 🚀 测试通过后

- [ ] 所有测试用例通过
- [ ] 文档已更新
- [ ] 准备切换到生产环境
- [ ] 进行小额真实支付测试

