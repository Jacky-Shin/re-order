# 手机端测试指南

## 问题：无法访问 10.0.0.59

如果遇到"拒绝了我们的连接请求"错误，请按以下步骤解决：

## 解决方案

### 1. 修改服务器配置（已完成）

✅ 已修改 `client/vite.config.ts`，添加 `host: '0.0.0.0'`
✅ 已修改 `server/src/index.ts`，监听所有网络接口

### 2. 重启服务器

**停止当前服务器**（如果正在运行）：
- 在运行服务器的终端按 `Ctrl + C`

**重新启动服务器**：
```bash
npm run dev
```

### 3. 检查防火墙

Windows防火墙可能会阻止连接，需要允许端口访问：

**方法一：通过Windows防火墙设置**
1. 打开"Windows Defender 防火墙"
2. 点击"高级设置"
3. 点击"入站规则" → "新建规则"
4. 选择"端口" → 下一步
5. 选择"TCP"，输入端口：`3000` 和 `5000`
6. 选择"允许连接"
7. 应用到所有配置文件
8. 命名规则（如：星巴克点餐系统）

**方法二：临时关闭防火墙测试**
1. 打开"Windows Defender 防火墙"
2. 点击"启用或关闭Windows Defender防火墙"
3. 临时关闭（仅用于测试）
4. ⚠️ 测试完成后记得重新开启！

### 4. 验证服务器运行

**检查端口是否监听**：
```bash
netstat -ano | findstr :3000
netstat -ano | findstr :5000
```

应该看到：
- `0.0.0.0:3000` （前端）
- `0.0.0.0:5000` （后端）

如果只看到 `127.0.0.1` 或 `[::1]`，说明配置未生效，需要重启服务器。

### 5. 手机访问

1. **确保手机和电脑在同一WiFi网络**
2. **在手机浏览器访问**：
   - 前端：`http://10.0.0.59:3000`
   - 二维码生成：`http://10.0.0.59:3000/qrcode`
   - 后端API：`http://10.0.0.59:5000/api/health`

3. **如果还是无法访问**：
   - 检查电脑IP地址是否正确：`ipconfig`
   - 尝试ping测试：在手机浏览器访问 `http://10.0.0.59:5000/api/health`
   - 检查路由器是否开启了AP隔离（某些公共WiFi会隔离设备）

### 6. 快速测试命令

```bash
# 获取本机IP地址
ipconfig | findstr IPv4

# 检查端口监听状态
netstat -ano | findstr ":3000 :5000"

# 测试本地连接
curl http://localhost:3000
curl http://localhost:5000/api/health
```

## 常见问题

### Q: 手机能ping通电脑，但无法访问网页
A: 检查防火墙设置，确保允许3000和5000端口

### Q: 显示"ERR_CONNECTION_REFUSED"
A: 服务器可能没有运行，或只监听了localhost，检查配置并重启

### Q: 显示"ERR_NETWORK_CHANGED"
A: 网络连接问题，确保手机和电脑在同一WiFi

### Q: 二维码扫描后无法打开
A: 检查二维码中的URL是否正确，确保包含IP地址而不是localhost

## 测试步骤总结

1. ✅ 修改配置（已完成）
2. ⏳ 重启服务器：`npm run dev`
3. ⏳ 配置防火墙（允许3000和5000端口）
4. ⏳ 手机访问：`http://10.0.0.59:3000`
5. ⏳ 生成二维码：`http://10.0.0.59:3000/qrcode`
6. ⏳ 手机扫描二维码测试

## 如果仍然无法访问

请提供以下信息：
- 服务器启动日志
- `netstat -ano | findstr ":3000 :5000` 的输出
- 手机访问时的具体错误信息
